!function(e,t){"use strict";let s="#chat-list",a,n;t(document).on("submit","#ticket_send_form",e=>{let s=t("#ticket_id").val(),a=t(e.target).find("[name=msg]").val();isEmpty(s)||t.ajax({url:"tickets/get",type:"POST",dataType:"json",data:{id:s},success(d){if(d&&"object"==typeof d&&d.status){let r=d.message.status,o=d.lang;isEmpty(a)?_toastify({message:o.required}):t.ajax({url:"tickets/sendMessage",type:"POST",dataType:"json",data:t(e.target).serialize(),beforeSend(){ajaxLoad.findBtn(e).attr("disabled",!0),ajaxLoad.findBtn(e).find(".ajaxLoadSpin").removeClass("d-none"),ajaxLoad.findBtn(e).find(".ajaxLoadAlert").addClass("d-none"),ajaxLoad.findBtn(e).find(".sendIcon").addClass("d-none")},complete(){ajaxLoad.findBtn(e).removeAttr("disabled"),ajaxLoad.findBtn(e).find(".ajaxLoadSpin").addClass("d-none"),ajaxLoad.findBtn(e).find(".sendIcon").removeClass("d-none")},error(){ajaxLoad.error(ajaxLoad.findBtn(e)),ajaxLoad.findBtn(e).find(".sendIcon").addClass("d-none")},success(e){e&&"object"==typeof e&&(t(document).trigger("refresh"),!1===e.status?_toastify({message:e.message}):(n.add({msg:e.message[0],date:e.message[1]}),t("#ticket_send_form input#input_msg").val(""),_toastify({status:!0,message:o.messageSend}),i(),(1===r||3===r)&&(t('.list.tickets-list .list-item[data-id="'+s+'"] .item-status').removeClass("gd-info").removeClass("gd-danger").addClass("gd-success").text(o.awaitingAnswer),window.setTimeout(()=>window.location.reload(),1e3))),t(document).trigger("refresh"))}})}}})}),t(document).on("click","#ticket_close_btn",()=>{let e=t("#ticket_id").val();(null!=e||""!==e)&&t.ajax({url:"tickets/get",type:"POST",dataType:"json",data:{id:e},success(e){if(e&&"object"==typeof e&&e.status){let s=e.lang;window.confirm(s.close)?t.ajax({url:"tickets/close",type:"POST",dataType:"json",data:{id:e.message.id},success(e){e&&"object"==typeof e&&(t(document).trigger("refresh"),!1===e.status?_toastify({message:e.message}):(_toastify({status:!0,message:s.closed}),e.status&&window.setTimeout(()=>window.location.reload(),1e3)),t(document).trigger("refresh"))}}):_toastify({message:s.closeCancel})}}})}),t(document).on("submit","#ticket_new_form",e=>{t.ajax({url:"tickets/add",type:"POST",dataType:"json",data:t(e.target).serialize(),beforeSend:()=>ajaxLoad.beforeSend(ajaxLoad.findBtn(e)),complete:()=>ajaxLoad.complete(ajaxLoad.findBtn(e)),error:()=>ajaxLoad.error(ajaxLoad.findBtn(e)),success(e){if(e&&"object"==typeof e){t(document).trigger("refresh");let s=e.lang;!1===e.status?_toastify({message:e.message}):(t("#ticket_new_modal").modal("hide"),_toastify({status:!0,message:s.created}),e.status&&window.setTimeout(()=>window.location.replace("tickets/"+e.message),1e3)),t(document).trigger("refresh")}}})});let i=(e=1e3)=>{sr.sync(),t(".scrollable",s).animate({scrollTop:t(".scrollable",s).prop("scrollHeight")},e,(e,t,s,a,n)=>0===t?s:t===n?s+a:(t/=n/2)<1?a/2*Math.pow(2,10*(t-1))+s:a/2*(-Math.pow(2,-10*--t)+2)+s)},d=function(){t(document).trigger("refresh"),(a=new List("#chat-nav".substr(1),{valueNames:["item-subject","item-date"]})).on("updated",()=>{a.matchingItems.length>0?t(".no-result").addClass("hide"):t(".no-result").removeClass("hide")}),n=new List(s.substr(1),{listClass:"chat-list",item:"chat-item",valueNames:["msg","date"]}),t(s+" .list").removeClass("hide"),sr.reveal(s+" .chat-item",{origin:"bottom",distance:"50px",afterReveal:e=>t(e).css("transform","none")},10),i()};e.chat={init:d}}(this,jQuery);