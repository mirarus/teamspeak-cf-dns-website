!function(e,t){"use strict";let s="#chat-list",a,i;t(document).on("submit","#ticket_send_form",e=>{let s=t("#ticket_id").val(),a=t(e.target).find("[name=msg]").val();isEmpty(s)||t.ajax({url:"tickets/get",type:"POST",dataType:"json",data:{id:s},success(l){if(l&&"object"==typeof l&&l.status){let d=l.message.status,r=l.lang;isEmpty(a)?_toastify({message:r.required}):t.ajax({url:"tickets/sendMessage",type:"POST",dataType:"json",data:t(e.target).serialize(),beforeSend(){ajaxLoad.beforeSend(ajaxLoad.findBtn(e)),ajaxLoad.findBtn(e).find(".sendIcon").addClass("d-none")},complete(){ajaxLoad.complete(ajaxLoad.findBtn(e)),ajaxLoad.findBtn(e).find(".sendIcon").removeClass("d-none")},error(){ajaxLoad.error(ajaxLoad.findBtn(e)),ajaxLoad.findBtn(e).find(".sendIcon").addClass("d-none")},success(e){e&&"object"==typeof e&&(t(document).trigger("refresh"),!1===e.status?_toastify({message:e.message}):(i.add({msg:e.message[0],date:e.message[1]}),t("#ticket_send_form input#input_msg").val(""),_toastify({status:!0,message:r.messageSend}),n(),(1===d||2===d)&&t('.list.tickets-list .list-item[data-id="'+s+'"] .item-status').removeClass("gd-info").removeClass("gd-danger").addClass("gd-success").text(r.awaitingAnswer)),t(document).trigger("refresh"))}})}}})}),t(document).on("click","#ticket_close_btn",e=>{let s=t("#ticket_id").val();(null!=s||""!==s)&&t.ajax({url:"tickets/get",type:"POST",dataType:"json",data:{id:s},success(e){if(e&&"object"==typeof e&&e.status){let s=e.lang;window.confirm(s.close)?t.ajax({url:"tickets/close",type:"POST",dataType:"json",data:{id:e.message.id},success(e){e&&"object"==typeof e&&(t(document).trigger("refresh"),!1===e.status?_toastify({message:e.message}):(_toastify({status:!0,message:s.closed}),e.status&&window.setTimeout(()=>window.location.reload(),1e3)),t(document).trigger("refresh"))}}):_toastify({message:s.closeCancel})}}})}),t(document).on("click","#ticket_delete_btn",()=>{let e=t("#ticket_id").val();(null!=e||""!==e)&&t.ajax({url:"tickets/get",type:"POST",dataType:"json",data:{id:e},success(e){if(e&&"object"==typeof e&&e.status){let s=e.lang;window.confirm(s.delete)?t.ajax({url:"tickets/delete",type:"POST",dataType:"json",data:{id:e.message.id},success(e){e&&"object"==typeof e&&(t(document).trigger("refresh"),!1===e.status?_toastify({message:e.message}):(_toastify({status:!0,message:s.deleted}),e.status&&window.setTimeout(()=>window.location.replace("tickets"),1e3)),t(document).trigger("refresh"))}}):_toastify({message:s.deleteCancel})}}})});let n=(e=1e3)=>{sr.sync(),t(".scrollable",s).animate({scrollTop:t(".scrollable",s).prop("scrollHeight")},e,(e,t,s,a,i)=>0===t?s:t===i?s+a:(t/=i/2)<1?a/2*Math.pow(2,10*(t-1))+s:a/2*(-Math.pow(2,-10*--t)+2)+s)},l=function(){t(document).trigger("refresh"),(a=new List("#chat-nav".substr(1),{valueNames:["item-subject","item-date"]})).on("updated",()=>{a.matchingItems.length>0?t(".no-result").addClass("hide"):t(".no-result").removeClass("hide")}),i=new List(s.substr(1),{listClass:"chat-list",item:"chat-item",valueNames:["msg","date"]}),t(s+" .list").removeClass("hide"),sr.reveal(s+" .chat-item",{origin:"bottom",distance:"50px",afterReveal:e=>t(e).css("transform","none")},10),n()};e.chat={init:l}}(this,jQuery);